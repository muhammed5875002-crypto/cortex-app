{% extends "layout.html" %}

{% block content %}

<h4 style="margin: 0 0 10px 0; font-size: 18px;">İstatistikler</h4>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
    <div class="ios-card" style="text-align: center; padding: 20px;">
        <i class="fas fa-dumbbell" style="font-size: 24px; color: var(--primary); margin-bottom: 5px;"></i>
        <div style="font-size: 24px; font-weight: 800;">{{ total }}</div>
        <div style="font-size: 12px; color: var(--text-sec);">Toplam Kayıt</div>
    </div>
    <div class="ios-card" style="text-align: center; padding: 20px;">
        <i class="fas fa-fire" style="font-size: 24px; color: var(--danger); margin-bottom: 5px;"></i>
        <div style="font-size: 18px; font-weight: 700; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">{{ fav }}</div>
        <div style="font-size: 12px; color: var(--text-sec);">Favori Bölge</div>
    </div>
</div>

<h4 style="margin: 0 0 10px 0; font-size: 18px;">Bölge Dağılımı</h4>
<div class="ios-card" style="padding: 20px; display: flex; justify-content: center;">
    <div style="width: 250px; height: 250px;">
        <canvas id="muscleChart"></canvas>
    </div>
</div>

<div class="ios-card" style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; padding: 20px;">
    <div>
        <div style="font-weight: 600;">Kür Disiplini</div>
        <div style="font-size: 12px; color: var(--text-sec);">Son 30 gün alınanlar</div>
    </div>
    <div style="font-size: 24px; font-weight: 800; color: var(--success);">{{ sup }}</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('muscleChart').getContext('2d');
    const labels = {{ labels | tojson }};
    const data = {{ data | tojson }};

    if (data.length === 0) {
        // Boş Grafik
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Veri Yok'],
                datasets: [{ data: [1], backgroundColor: ['#333'], borderWidth: 0 }]
            },
            options: { plugins: { legend: { display: false } }, cutout: '70%' }
        });
    } else {
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: ['#0A84FF', '#30D158', '#FF453A', '#BF5AF2', '#FF9F0A', '#64D2FF'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom', labels: { color: '#8E8E93', boxWidth: 10 } } },
                cutout: '70%'
            }
        });
    }
</script>

{% endblock %}