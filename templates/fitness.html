{% extends "layout.html" %}

{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div id="toast" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; background: rgba(48, 209, 88, 0.9); padding: 12px 24px; border-radius: 25px; backdrop-filter: blur(10px); color: white; font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.5);">
      {{ messages[0][1] }}
    </div>
    <script>setTimeout(() => document.getElementById('toast').remove(), 2500);</script>
  {% endif %}
{% endwith %}

<div class="ios-card" style="display: flex; justify-content: space-between; padding: 15px; margin-bottom: 20px;">
    {% for day in calendar %}
    <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
        <div style="width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            background: {{ 'var(--success)' if day.active else 'rgba(255,255,255,0.05)' }};
            color: {{ 'black' if day.active else 'transparent' }};">
            {% if day.active %}<i class="fas fa-check" style="font-size: 12px;"></i>{% endif %}
        </div>
        <span style="font-size: 10px; color: {{ 'white' if day.is_today else 'var(--text-sec)' }}; font-weight: {{ 'bold' if day.is_today else 'normal' }};">{{ day.day }}</span>
    </div>
    {% endfor %}
</div>

<h4 style="margin: 0 0 10px 0; font-size: 18px;">Antrenman Gir</h4>
<div class="ios-card">
    <form method="POST">
        <input type="hidden" name="add_workout" value="1">
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label class="small-label">Bölge</label>
                <select name="bolge" id="typeSelect" onchange="toggleInputs()" style="width: 100%;">
                    <optgroup label="Ağırlık">
                        <option value="Göğüs">Göğüs</option>
                        <option value="Sırt">Sırt</option>
                        <option value="Bacak">Bacak</option>
                        <option value="Omuz">Omuz</option>
                        <option value="Kol">Kol</option>
                        <option value="Karın">Karın</option>
                    </optgroup>
                    <optgroup label="Kardiyo">
                        <option value="Kardiyo">Kardiyo / Koşu</option>
                    </optgroup>
                </select>
            </div>
            <div style="flex: 2;">
                <label class="small-label">Hareket</label>
                <input type="text" name="hareket" placeholder="Örn: Bench Press" required>
            </div>
        </div>

        <div id="strengthInputs" style="display: flex; gap: 10px; align-items: flex-end;">
            <div style="flex: 1;"><label class="small-label">Set</label><input type="number" name="sets" placeholder="4"></div>
            <div style="flex: 1;"><label class="small-label">Tekrar</label><input type="number" name="tekrar" placeholder="12"></div>
            <div style="flex: 1;"><label class="small-label">Kg</label><input type="number" name="agirlik" placeholder="60" step="0.5"></div>
            <button type="submit" class="btn-primary" style="width: 50px; height: 44px; border-radius: 10px;"><i class="fas fa-plus"></i></button>
        </div>

        <div id="cardioInputs" style="display: none; gap: 10px; align-items: flex-end;">
            <div style="flex: 1;"><label class="small-label">Süre (Dk)</label><input type="number" name="sure" placeholder="30"></div>
            <div style="flex: 1;"><label class="small-label">Mesafe (Km)</label><input type="number" name="mesafe" placeholder="5" step="0.1"></div>
            <div style="flex: 1;"></div> <button type="submit" class="btn-primary" style="width: 50px; height: 44px; border-radius: 10px;"><i class="fas fa-plus"></i></button>
        </div>
    </form>
</div>

<h4 style="margin: 30px 0 10px 0; font-size: 18px;">Geçmiş</h4>
{% for group in history %}
    <div style="margin-bottom: 15px;">
        <div style="font-size: 12px; color: var(--primary); font-weight: bold; margin-bottom: 5px; padding-left: 5px;">{{ group.date }}</div>
        <div class="ios-card" style="padding: 0;">
            {% for item in group.items %}
            <div style="padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
                
                <div>
                    <div style="font-weight: 600; font-size: 14px;">{{ item.hareket }}</div>
                    <div style="font-size: 11px; color: var(--text-sec);">{{ item.bolge }}</div>
                </div>

                <div style="text-align: right; display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 13px; font-weight: 500;">
                        {% if item.bolge == 'Kardiyo' %}
                            <span style="color: #FF9F0A;">{{ item.sure }} dk</span>
                            <span style="color: var(--text-sec);">•</span> 
                            <span>{{ item.mesafe }} km</span>
                        {% else %}
                            <span style="color: var(--success);">{{ item.agirlik }} kg</span>
                            <span style="color: var(--text-sec);">•</span>
                            <span>{{ item.set_sayisi }} x {{ item.tekrar }}</span>
                        {% endif %}
                    </div>
                    
                    <form method="POST" style="margin:0;">
                        <input type="hidden" name="del_workout" value="1">
                        <input type="hidden" name="w_id" value="{{ item.id }}">
                        <button type="submit" style="background:none; border:none; color: #FF453A; opacity: 0.5; padding: 5px;"><i class="fas fa-times"></i></button>
                    </form>
                </div>

            </div>
            {% endfor %}
        </div>
    </div>
{% endfor %}

<h4 style="margin: 30px 0 10px 0; font-size: 18px;">Kür Takibi</h4>
<div class="ios-card">
    {% for sup in supplements %}
    <div class="check-row" style="display: flex; justify-content: space-between; align-items: center;">
        <form method="POST" style="flex-grow: 1; margin:0;">
            <input type="hidden" name="toggle_sup" value="1"><input type="hidden" name="sup_id" value="{{ sup.id }}">
            <button type="submit" style="background: none; border: none; width: 100%; text-align: left; display: flex; align-items: center; padding: 0;">
                <div style="width: 32px; height: 32px; background: {{ 'rgba(48, 209, 88, 0.2)' if sup.taken else 'rgba(255,255,255,0.1)' }}; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                    <i class="fas fa-pills" style="color: {{ '#30D158' if sup.taken else '#8E8E93' }};"></i>
                </div>
                <div><div style="font-weight: 600; color: {{ 'white' if sup.taken else '#8E8E93' }};">{{ sup.name }}</div><div style="font-size: 11px; color: var(--text-sec);">{{ sup.dozaj }}</div></div>
                <div style="margin-left: auto; margin-right: 15px;">{% if sup.taken %}<i class="fas fa-check-circle" style="color: var(--success); font-size: 18px;"></i>{% else %}<div style="width: 18px; height: 18px; border-radius: 50%; border: 2px solid #444;"></div>{% endif %}</div>
            </button>
        </form>
        <form method="POST" style="margin:0;"><input type="hidden" name="del_sup_def" value="1"><input type="hidden" name="sup_id" value="{{ sup.id }}"><button type="submit" style="background:none;border:none;color:#FF453A;opacity:0.6;"><i class="fas fa-trash-alt"></i></button></form>
    </div>
    {% endfor %}
    <div onclick="document.getElementById('supModal').style.display='flex'" style="padding: 12px 0; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); cursor: pointer; color: var(--primary); font-size: 13px; font-weight: 600;">+ Yeni Takviye</div>
</div>

<div id="supModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
    <div class="ios-card" style="width: 80%; max-width: 300px; background: #1c1c1e;">
        <h4 style="text-align: center; margin-top: 0;">Takviye Ekle</h4>
        <form method="POST">
            <input type="hidden" name="add_sup_def" value="1">
            <label class="small-label">Ad</label><input type="text" name="name" required style="margin-bottom: 10px;">
            <label class="small-label">Dozaj</label><input type="text" name="dozaj" required style="margin-bottom: 20px;">
            <div style="display: flex; gap: 10px;"><button type="button" onclick="document.getElementById('supModal').style.display='none'" class="btn" style="background:#333;color:white;">İptal</button><button type="submit" class="btn btn-primary">Ekle</button></div>
        </form>
    </div>
</div>

<style>.small-label { font-size: 10px; color: var(--text-sec); margin-left: 2px; margin-bottom: 4px; display: block; }</style>

<script>
    function toggleInputs() {
        var val = document.getElementById('typeSelect').value;
        var strength = document.getElementById('strengthInputs');
        var cardio = document.getElementById('cardioInputs');
        
        if(val === 'Kardiyo') {
            strength.style.display = 'none';
            cardio.style.display = 'flex';
        } else {
            strength.style.display = 'flex';
            cardio.style.display = 'none';
        }
    }
</script>

{% endblock %}